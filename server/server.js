import config from "./config/config.js";
//////////////////////////////////////////////////////////////////////////////////////
//  UnCaught Exception
//////////////////////////////////////////////////////////////////////////////////////
process.on("uncaughtException", (error, origin) => {
	console.error(error);
	console.error(origin);
	process.exit(1);
});

//////////////////////////////////////////////////////////////////////////////////////
//  Database connection.
//////////////////////////////////////////////////////////////////////////////////////
import mongoose from "mongoose";

mongoose.connect(config.mongoose.URLLocal, { dbName: "food_fusion" }).then((conn) => {
	console.log("Database connection is successful");
	console.log(`Host: ${conn.connection.host}\nPort: ${conn.connection.port}\n`);
});

//////////////////////////////////////////////////////////////////////////////////////
//  Express App
//////////////////////////////////////////////////////////////////////////////////////
import app from "./app.js";

const server = app.listen(config.port, config.host, () => {
	console.log(`Server has started at ${config.host} on port ${config.port}`);
});

//////////////////////////////////////////////////////////////////////////////////////
//  Unhandled Rejection: Rejection promise outside express app like when database connection
// then exception is thrown in that case we want ot to close the server and then exit program.
//////////////////////////////////////////////////////////////////////////////////////
process.on("unhandledRejection", (error, origin) => {
	console.error(error, origin);
	server.close(() => {
		process.exit(1);
	});
});
